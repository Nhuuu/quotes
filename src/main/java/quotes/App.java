/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package quotes;

import com.google.gson.Gson;

import java.io.*;
import java.net.HttpURLConnection;
import java.net.URL;

public class App {

  public static void main(String[] args) throws FileNotFoundException {
    getQuoteFromAPI();
  }

  public static void getQuoteFromAPI() throws FileNotFoundException {
    // https://www.baeldung.com/java-http-request
    try {
      URL url = new URL("http://swquotesapi.digitaljedi.dk/api/SWQuote/RandomStarWarsQuote");
      HttpURLConnection con = (HttpURLConnection) url.openConnection();
      con.setRequestMethod("GET");
      BufferedReader in = new BufferedReader(new InputStreamReader(con.getInputStream()));
      Gson gson = new Gson();
      ApiQuote apiQuote = gson.fromJson(in, ApiQuote.class);
      writeToApiFile(apiQuote);
      in.close();
      System.out.println(apiQuote);
    } catch (IOException e) {
      e.printStackTrace();
      Quote[] quotes = makeQuotesFromFile();
      System.out.println(getRandomQuoteFromFile(quotes));
    }
  }

  public static void writeToApiFile(ApiQuote quote) {
    BufferedWriter writer = null;
    try {
      Gson gson = new Gson();
      String makeJson = gson.toJson(quote);
      writer = new BufferedWriter(new FileWriter("src/main/resources/apiquotes.json", true));
      writer.newLine();
      writer.append(makeJson);
      writer.close();
    } catch (IOException e) {
      e.printStackTrace();
    }
  }

  public static Quote[] makeQuotesFromFile() throws FileNotFoundException {
    Gson gson = new Gson();
    Quote[] quotes = gson.fromJson(new FileReader("src/main/resources/recentquotes.json"), Quote[].class);
    return quotes;
  }

  public static Quote getRandomQuoteFromFile(Quote[] quotes) {
    int random = (int)(Math.random() * quotes.length);
    return quotes[random];
  }
}

